--- a/node_modules/@ai-sdk/anthropic/dist/index.mjs	2025-10-02 23:43:35
+++ b/node_modules/@ai-sdk/anthropic/dist/index.mjs	2025-10-11 22:31:09
@@ -592,6 +592,114 @@
                 const isLastPart = i2 === content.length - 1;
                 const cacheControl = (_d = getCacheControl(part.providerOptions)) != null ? _d : isLastPart ? getCacheControl(message.providerOptions) : void 0;
                 const output = part.output;
+                let handledServerToolResult = false;
+                if (part.toolName === "code_execution") {
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
+                  if (output.type !== "json") {
+                    warnings.push({
+                      type: "other",
+                      message: `provider tool result output type ${output.type} for tool ${part.toolName} is not supported`
+                    });
+                    anthropicContent.push({
+                      type: "code_execution_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "code_execution_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
+                    });
+                    handledServerToolResult = true;
+                  }
+                  const codeExecutionOutput = codeExecution_20250522OutputSchema.parse(output.value);
+                  anthropicContent.push({
+                    type: "code_execution_tool_result",
+                    tool_use_id: part.toolCallId,
+                    content: {
+                      type: codeExecutionOutput.type,
+                      stdout: codeExecutionOutput.stdout,
+                      stderr: codeExecutionOutput.stderr,
+                      return_code: codeExecutionOutput.return_code
+                    },
+                    cache_control: cacheControl
+                  });
+                  handledServerToolResult = true;
+                } else if (part.toolName === "web_fetch") {
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
+                  if (output.type !== "json") {
+                    warnings.push({
+                      type: "other",
+                      message: `provider tool result output type ${output.type} for tool ${part.toolName} is not supported`
+                    });
+                    anthropicContent.push({
+                      type: "web_fetch_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "web_fetch_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
+                    });
+                    handledServerToolResult = true;
+                  }
+                  const webFetchOutput = webFetch_20250910OutputSchema.parse(output.value);
+                  anthropicContent.push({
+                    type: "web_fetch_tool_result",
+                    tool_use_id: part.toolCallId,
+                    content: {
+                      type: "web_fetch_result",
+                      url: webFetchOutput.url,
+                      retrieved_at: webFetchOutput.retrievedAt,
+                      content: {
+                        type: "document",
+                        title: webFetchOutput.content.title,
+                        citations: webFetchOutput.content.citations,
+                        source: {
+                          type: webFetchOutput.content.source.type,
+                          media_type: webFetchOutput.content.source.mediaType,
+                          data: webFetchOutput.content.source.data
+                        }
+                      }
+                    },
+                    cache_control: cacheControl
+                  });
+                  handledServerToolResult = true;
+                } else if (part.toolName === "web_search") {
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
+                  if (output.type !== "json") {
+                    warnings.push({
+                      type: "other",
+                      message: `provider tool result output type ${output.type} for tool ${part.toolName} is not supported`
+                    });
+                    anthropicContent.push({
+                      type: "web_search_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "web_search_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
+                    });
+                    handledServerToolResult = true;
+                  }
+                  const webSearchOutput = webSearch_20250305OutputSchema.parse(output.value);
+                  anthropicContent.push({
+                    type: "web_search_tool_result",
+                    tool_use_id: part.toolCallId,
+                    content: webSearchOutput.map((result) => ({
+                      url: result.url,
+                      title: result.title,
+                      page_age: result.pageAge,
+                      encrypted_content: result.encryptedContent,
+                      type: result.type
+                    })),
+                    cache_control: cacheControl
+                  });
+                  handledServerToolResult = true;
+                }
+                if (handledServerToolResult) {
+                  continue;
+                }
                 let contentValue;
                 switch (output.type) {
                   case "content":
@@ -657,6 +765,7 @@
           const message = block.messages[j];
           const isLastMessage = j === block.messages.length - 1;
           const { content } = message;
+          const hasRegularToolCalls = content.some((part) => part.type === "tool-call" && !part.providerExecuted);
           for (let k = 0; k < content.length; k++) {
             const part = content[k];
             const isLastContentPart = k === content.length - 1;
@@ -744,13 +853,26 @@
                 break;
               }
               case "tool-result": {
+                if (hasRegularToolCalls && (part.toolName === "web_search" || part.toolName === "web_fetch" || part.toolName === "code_execution")) {
+                  break;
+                }
                 if (part.toolName === "code_execution") {
                   const output = part.output;
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
                   if (output.type !== "json") {
                     warnings.push({
                       type: "other",
                       message: `provider executed tool result output type ${output.type} for tool ${part.toolName} is not supported`
                     });
+                    anthropicContent.push({
+                      type: "code_execution_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "code_execution_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
+                    });
                     break;
                   }
                   const codeExecutionOutput = codeExecution_20250522OutputSchema.parse(output.value);
@@ -769,11 +891,21 @@
                 }
                 if (part.toolName === "web_fetch") {
                   const output = part.output;
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
                   if (output.type !== "json") {
                     warnings.push({
                       type: "other",
                       message: `provider executed tool result output type ${output.type} for tool ${part.toolName} is not supported`
                     });
+                    anthropicContent.push({
+                      type: "web_fetch_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "web_fetch_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
+                    });
                     break;
                   }
                   const webFetchOutput = webFetch_20250910OutputSchema.parse(
@@ -803,10 +935,20 @@
                 }
                 if (part.toolName === "web_search") {
                   const output = part.output;
+                  const errorCode = output.type === "error-text" || output.type === "error-json" ? "provider_error" : "invalid_output";
                   if (output.type !== "json") {
                     warnings.push({
                       type: "other",
                       message: `provider executed tool result output type ${output.type} for tool ${part.toolName} is not supported`
+                    });
+                    anthropicContent.push({
+                      type: "web_search_tool_result",
+                      tool_use_id: part.toolCallId,
+                      content: {
+                        type: "web_search_tool_result_error",
+                        error_code: errorCode
+                      },
+                      cache_control: cacheControl
                     });
                     break;
                   }
@@ -1358,6 +1500,12 @@
       fetch: this.config.fetch
     });
     const content = [];
+    const hasRegularToolCall = response.content.some((part) => part.type === "tool_use");
+    const hasProviderToolResult = response.content.some((part) =>
+      part.type === "web_search_tool_result" ||
+      part.type === "web_fetch_tool_result" ||
+      part.type === "code_execution_tool_result"
+    );
+    const skipProviderResults = hasRegularToolCall && hasProviderToolResult;
     for (const part of response.content) {
       switch (part.type) {
         case "text": {
@@ -1418,6 +1566,9 @@
         }
         case "server_tool_use": {
           if (part.name === "web_search" || part.name === "code_execution" || part.name === "web_fetch") {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-call",
               toolCallId: part.id,
@@ -1430,6 +1581,9 @@
         }
         case "web_fetch_tool_result": {
           if (part.content.type === "web_fetch_result") {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -1453,6 +1607,9 @@
             });
           } else if (part.content.type === "web_fetch_tool_result_error") {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -1468,6 +1625,9 @@
         }
         case "web_search_tool_result": {
           if (Array.isArray(part.content)) {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -1500,6 +1660,9 @@
             }
           } else {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -1515,6 +1678,9 @@
         }
         case "code_execution_tool_result": {
           if (part.content.type === "code_execution_result") {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -1529,6 +1695,9 @@
             });
           } else if (part.content.type === "code_execution_tool_result_error") {
+            if (skipProviderResults) {
+              break;
+            }
             content.push({
               type: "tool-result",
               toolCallId: part.tool_use_id,
@@ -2452,4 +2621,4 @@
   anthropic,
   createAnthropic
 };
-//# sourceMappingURL=index.mjs.map
\ No newline at end of file
+//# sourceMappingURL=index.mjs.map
